!function(){function e(e){var t=Array.prototype.slice.call(arguments,1);return this.each(function(){if($(this).data("addressIntegration"))if("object"==typeof e)$.error("jQuery.addressIntegration already initialized");else{var r=$(this).data("addressIntegration");r[e]?r[e].apply(r,t):$.error("Method "+e+" does not exist on jQuery.addressIntegration")}else{var r=new s(this,e);$(this).data("addressIntegration",r),r.init()}})}var t,r=0,s=function(s,n){var a=this;a.guid=r,a.settings=$.extend({},e.defaults,n),a.$element=$(s),a.eventPrefix=".addressIntegration"+a.guid,a.events=o(a.settings.events,a.eventPrefix),a.errors=null,a.lastValue="",a.querries=0,a.querriesTmp=0,t||(t=new google.maps.Geocoder),a.geocoder=t,a.debounce=$.debounce(a.settings.debounceEventsTime,function(){0!==a.querriesTmp&&a.checkAddress()})},o=function(e,t){var r=new Array;r=e.split(" ");for(var s="",o=0;o<r.length;o++)s+=r[o]+t+" ";return s},n=function(e,t,r){for(var s,o=e[0].address_components,n=0;n<o.length;++n){var i=o[n].types;a(i,t)&&(s=o[n][r])}return s},a=function(e,t){for(var r=0;r<e.length;++r)if(e[r]==t)return!0;return!1},i={GOOGLE_MAPS_ERROR:"Google maps error.",OVER_QUERY_LIMIT:"Too many queries! Please wait a moment and try again.",REQUEST_DENIED:"Your request was denied",INVALID_REQUEST:"Your query is missing",UNKNOWN_ERROR:"Propably server error, please try again.",UNKNOWN_ERROR_2:"Unknown error.",ERROR:"Google maps unknown error."};s.prototype={init:function(){var e=this,t=this.$element;t.val()&&e.checkAddress(),t.on(e.events,function(){(t.val()!==e.lastValue||e.errors in i)&&(e.querries++,e.querriesTmp++,e.settings.callbackEventFired.apply(e),e.debounce())})},checkAddress:function(){var e=this;this.$element;e.checkAddressCustom(e.settings.callbackSuccess,e.settings.callbackError,e.settings.callbackInProgress)},checkAddressCustom:function(e,r,s){var o=this,n=this.$element;o.querries=o.querries-o.querriesTmp+1,o.querriesTmp=0;var a=o.querries;o.lastValue=n.val();var i=n.val();if(o.settings.regionCode)var c={address:i,region:o.settings.regionCode};else var c={address:i};o.showLoader(),s&&s.apply(o),o.geocoder.geocode(c,function(s,n){n==google.maps.GeocoderStatus.OK?t.geocode({latLng:s[0].geometry.location},function(t,s){s==google.maps.GeocoderStatus.OK?t[1]?o.queue(a,function(){o.checkAddressSuccess(t,e)}):o.queue(a,function(){o.checkAddressFail("NO_RESULTS",r)}):o.queue(a,function(){o.checkAddressFail(s,r)})}):o.queue(a,function(){o.checkAddressFail(n,r)})})},queue:function(e,t){var r=this;e===r.querries&&t()},checkAddressSuccess:function(e,t){var r=this;this.$element;null!==r.errors&&(r.errors=null,r.hideErrors()),r.hideLoader(),r.setFields(e),t&&t.call(r,e)},checkAddressFail:function(e,t){var r=this;this.$element;r.errors=e,r.hideLoader(),r.showErrors(),t&&t.call(r,e)},setFields:function(e){var t=this;t.settings.countrySelector&&$(t.settings.countrySelector).val(n(e,"country","long_name")),t.settings.countryShortSelector&&$(t.settings.countryShortSelector).val(n(e,"country","short_name")),t.settings.citySelector&&$(t.settings.citySelector).val(n(e,"locality","long_name")),t.settings.stateSelector&&$(t.settings.stateSelector).val(n(e,"administrative_area_level_1","long_name")),t.settings.stateShortSelector&&$(t.settings.stateShortSelector).val(n(e,"administrative_area_level_1","short_name")),t.settings.postalCodeSelector&&$(t.settings.postalCodeSelector).val(n(e,"postal_code","long_name")),t.settings.routeSelector&&$(t.settings.routeSelector).val(n(e,"route","long_name")),t.settings.streetNumberSelector&&$(t.settings.streetNumberSelector).val(n(e,"street_number","long_name"))},showErrors:function(){var e=this;"ZERO_RESULTS"===e.errors||"NO_RESULTS"===e.errors?$(e.settings.messageSelector).text(e.settings.customErrorMessage).show():e.errors in i?$(e.settings.messageSelector).text(i[e.errors]).show():$(e.settings.messageSelector).text(e.errors).show()},hideErrors:function(){var e=this;$(e.settings.messageSelector).hide().empty()},showLoader:function(){var e=this;$(e.settings.loaderSelector).show()},hideLoader:function(){var e=this;$(e.settings.loaderSelector).hide()},unbindEvents:function(){var e=this;e.$element.off(e.eventPrefix)},destroy:function(){var e=this;e.unbindEvents(),e.$element.data("addressIntegration",null)}},e.defaults={regionCode:!1,events:"propertychange change click keyup input paste",debounceEventsTime:250,customErrorMessage:"No results for given data, the given place propably does not exist.",countrySelector:"#country",countryShortSelector:"#country_short",citySelector:"#city",stateSelector:"#state",stateShortSelector:"#state_short",postalCodeSelector:"#postal_code",routeSelector:"#route",streetNumberSelector:"#street_number",loaderSelector:"#addressIntegrationLoader",messageSelector:"#addressIntegrationMessages",callbackEventFired:function(){},callbackInProgress:function(){},callbackSuccess:function(e){},callbackError:function(e){}},$.fn.addressIntegration=e}();