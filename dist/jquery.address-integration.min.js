!function(){function e(e){var t=Array.prototype.slice.call(arguments,1);return this.each(function(){if($(this).data("addressIntegration"))if("object"==typeof e)$.error("jQuery.addressIntegration already initialized");else{var r=$(this).data("addressIntegration");r[e]?r[e].apply(r,t):$.error("Method "+e+" does not exist on jQuery.addressIntegration")}else{var r=new s(this,e);$(this).data("addressIntegration",r),r.init()}})}var t,r=0,s=function(s,o){var a=this;a.guid=r,a.settings=$.extend({},e.defaults,o),a.$element=$(s),a.eventPrefix=".addressIntegration"+a.guid,a.events=n(a.settings.events,a.eventPrefix),a.errors=null,a.lastValue="",a.querries=0,a.querriesTmp=0,a.timerQueryRetry=null,t||(t=new google.maps.Geocoder),a.geocoder=t,a.debounce=$.debounce(a.settings.debounceEventsTime,function(){0!==a.querriesTmp&&a.checkAddress()})},n=function(e,t){var r=new Array;r=e.split(" ");for(var s="",n=0;n<r.length;n++)s+=r[n]+t+" ";return s},o=function(e,t,r){for(var s=e[0].address_components,n=null,o=0;o<s.length;++o){var i=s[o].types;a(i,t)&&(n=s[o][r])}return n},a=function(e,t){for(var r=0;r<e.length;++r)if(e[r]==t)return!0;return!1},i={GOOGLE_MAPS_ERROR:"Google maps error.",OVER_QUERY_LIMIT:"Too many queries! Please wait a moment and try again.",REQUEST_DENIED:"Your request was denied",INVALID_REQUEST:"Your query is missing",UNKNOWN_ERROR:"Propably server error, please try again.",UNKNOWN_ERROR_2:"Unknown error.",ERROR:"Google maps unknown error."};s.prototype={init:function(){var e=this,t=this.$element;t.val()&&e.checkAddress(),t.on(e.events,function(){(t.val()!==e.lastValue||e.errors in i)&&(e.querries++,e.querriesTmp++,e.settings.callbackEventFired.apply(e),e.debounce())})},checkAddress:function(){var e=this;this.$element;e.checkAddressCustom(e.settings.callbackSuccess,e.settings.callbackError,e.settings.callbackInProgress)},checkAddressCustom:function(e,t,r){var s=this,n=this.$element;s.querries=s.querries-s.querriesTmp+1,s.querriesTmp=0;var o=s.querries;s.lastValue=n.val();var a=n.val(),i={address:a};i.componentRestrictions={},s.settings.zipcodeMode&&(i.componentRestrictions.postalCode=a),s.settings.regionInfluence&&(i.region=s.settings.regionInfluence),s.settings.regionRestriction&&(i.componentRestrictions.country=s.settings.regionRestriction),s.showLoader(),r&&r.apply(s),s.geocoder.geocode(i,function(r,n){n==google.maps.GeocoderStatus.OK?s.geocoder.geocode({placeId:r[0].place_id},function(r,n){n==google.maps.GeocoderStatus.OK?r[0]?s.queue(o,function(){s.checkAddressSuccess(r,e)}):s.queue(o,function(){s.checkAddressFail("NO_RESULTS",t)}):s.queue(o,function(){s.checkAddressFail(n,t)})}):s.queue(o,function(){s.checkAddressFail(n,t)})})},queue:function(e,t){var r=this;e===r.querries&&t()},createFormattedResults:function(e){return{country:{long_name:o(e,"country","long_name"),short_name:o(e,"country","short_name")},city:{long_name:o(e,"locality","long_name"),short_name:o(e,"locality","short_name")},state:{long_name:o(e,"administrative_area_level_1","long_name"),short_name:o(e,"administrative_area_level_1","short_name")},postal_code:{long_name:o(e,"postal_code","long_name"),short_name:o(e,"postal_code","short_name")},street:{long_name:o(e,"route","long_name"),short_name:o(e,"route","short_name")},street_number:{long_name:o(e,"street_number","long_name"),short_name:o(e,"street_number","short_name")}}},checkAddressSuccess:function(e,t){var r=this,s=(this.$element,r.createFormattedResults(e));clearTimeout(r.timerQueryRetry),null!==r.errors&&(r.errors=null,r.hideErrors()),r.hideLoader(),r.setFields(e),t&&t.call(r,e,s)},checkAddressFail:function(e,t){var r=this;this.$element;clearTimeout(r.timerQueryRetry),"OVER_QUERY_LIMIT"===e?r.timerQueryRetry=setTimeout(function(){r.checkAddress()},r.settings.retryTime):(r.errors=e,r.hideLoader(),r.showErrors(),t&&t.call(r,e))},setFields:function(e){var t=this;t.settings.countrySelector&&$(t.settings.countrySelector).val(o(e,"country","long_name")),t.settings.countryShortSelector&&$(t.settings.countryShortSelector).val(o(e,"country","short_name")),t.settings.citySelector&&$(t.settings.citySelector).val(o(e,"locality","long_name")),t.settings.stateSelector&&$(t.settings.stateSelector).val(o(e,"administrative_area_level_1","long_name")),t.settings.stateShortSelector&&$(t.settings.stateShortSelector).val(o(e,"administrative_area_level_1","short_name")),t.settings.postalCodeSelector&&$(t.settings.postalCodeSelector).val(o(e,"postal_code","long_name")),t.settings.routeSelector&&$(t.settings.routeSelector).val(o(e,"route","long_name")),t.settings.streetNumberSelector&&$(t.settings.streetNumberSelector).val(o(e,"street_number","long_name"))},showErrors:function(){var e=this;"ZERO_RESULTS"===e.errors||"NO_RESULTS"===e.errors?$(e.settings.messageSelector).text(e.settings.customErrorMessage).show():e.errors in i?$(e.settings.messageSelector).text(i[e.errors]).show():$(e.settings.messageSelector).text(e.errors).show()},hideErrors:function(){var e=this;$(e.settings.messageSelector).hide().empty()},showLoader:function(){var e=this;$(e.settings.loaderSelector).show()},hideLoader:function(){var e=this;$(e.settings.loaderSelector).hide()},unbindEvents:function(){var e=this;e.$element.off(e.eventPrefix)},destroy:function(){var e=this;e.unbindEvents(),e.$element.data("addressIntegration",null)}},e.defaults={zipcodeMode:!1,regionInfluence:!1,regionRestriction:!1,events:"propertychange change click keyup input paste",debounceEventsTime:250,retryTime:3e3,customErrorMessage:"No results for given data, the given place propably does not exist.",countrySelector:"#country",countryShortSelector:"#country-short",citySelector:"#city",stateSelector:"#state",stateShortSelector:"#state-short",postalCodeSelector:"#postal-code",routeSelector:"#route",streetNumberSelector:"#street-number",loaderSelector:"#address-integration-loader",messageSelector:"#address-integration-messages",callbackEventFired:function(){},callbackInProgress:function(){},callbackSuccess:function(e,t){},callbackError:function(e){}},$.fn.addressIntegration=e}();