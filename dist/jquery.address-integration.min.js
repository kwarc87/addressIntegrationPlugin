!function(){function e(e){var t=Array.prototype.slice.call(arguments,1);return this.each(function(){if($(this).data("addressIntegration"))if("object"==typeof e)$.error("jQuery.addressIntegration already initialized");else{var r=$(this).data("addressIntegration");r[e]?r[e].apply(r,t):$.error("Method "+e+" does not exist on jQuery.addressIntegration")}else{var r=new n(this,e);$(this).data("addressIntegration",r),r.init()}})}var t,r=0,n=function(n,o){var a=this;a.guid=r,a.settings=$.extend({},e.defaults,o),a.$element=$(n),a.eventPrefix=".addressIntegration"+a.guid,a.events=s(a.settings.events,a.eventPrefix),a.errors=null,a.lastValue="",a.querries=0,a.querriesTmp=0,a.timerQueryRetry=null,t||(t=new google.maps.Geocoder),a.geocoder=t,a.debounce=$.debounce(a.settings.debounceEventsTime,function(){0!==a.querriesTmp&&a.checkAddress()})},s=function(e,t){var r=new Array;r=e.split(" ");for(var n="",s=0;s<r.length;s++)n+=r[s]+t+" ";return n},o=function(e,t,r){for(var n=e[0].address_components,s=null,o=0;o<n.length;++o){var i=n[o].types;a(i,t)&&(s=n[o][r])}return s},a=function(e,t){for(var r=0;r<e.length;++r)if(e[r]==t)return!0;return!1},i={GOOGLE_MAPS_ERROR:"Google maps error.",OVER_QUERY_LIMIT:"Too many queries! Please wait a moment and try again.",REQUEST_DENIED:"Your request was denied",INVALID_REQUEST:"Your query is missing",UNKNOWN_ERROR:"Propably server error, please try again.",UNKNOWN_ERROR_2:"Unknown error.",ERROR:"Google maps unknown error."};n.prototype={init:function(){var e=this,t=this.$element;t.val()&&e.checkAddress(),t.on(e.events,function(){(t.val()!==e.lastValue||e.errors in i)&&(e.querries++,e.querriesTmp++,e.settings.callbackEventFired.apply(e),e.debounce())})},checkAddress:function(){var e=this;this.$element;e.checkAddressCustom(e.settings.callbackSuccess,e.settings.callbackError,e.settings.callbackInProgress)},checkAddressCustom:function(e,t,r){var n=this,s=this.$element;n.querries=n.querries-n.querriesTmp+1,n.querriesTmp=0;var o=n.querries;n.lastValue=s.val();var a=s.val(),i={address:a};i.componentRestrictions={},n.settings.zipcodeMode&&(i.componentRestrictions.postalCode=a),n.settings.regionInfluence&&(i.region=n.settings.regionInfluence),n.settings.regionRestriction&&(i.componentRestrictions.country=n.settings.regionRestriction),n.showLoader(),r&&r.apply(n),n.geocoder.geocode(i,function(r,s){s==google.maps.GeocoderStatus.OK?n.geocoder.geocode({placeId:r[0].place_id},function(r,s){s==google.maps.GeocoderStatus.OK?r[0]?n.queue(o,function(){n.checkAddressSuccess(r,e)}):n.queue(o,function(){n.checkAddressFail("NO_RESULTS",t)}):n.queue(o,function(){n.checkAddressFail(s,t)})}):n.queue(o,function(){n.checkAddressFail(s,t)})})},queue:function(e,t){var r=this;e===r.querries&&t()},createFormattedResults:function(e){return{country:{long_name:o(e,"country","long_name"),short_name:o(e,"country","short_name")},city:{long_name:o(e,"locality","long_name"),short_name:o(e,"locality","short_name")},state:{long_name:o(e,"administrative_area_level_1","long_name"),short_name:o(e,"administrative_area_level_1","short_name")},postal_code:{long_name:o(e,"postal_code","long_name"),short_name:o(e,"postal_code","short_name")},street:{long_name:o(e,"route","long_name"),short_name:o(e,"route","short_name")},street_number:{long_name:o(e,"street_number","long_name"),short_name:o(e,"street_number","short_name")}}},checkAddressSuccess:function(e,t){var r=this,n=(this.$element,r.createFormattedResults(e));clearTimeout(r.timerQueryRetry),null!==r.errors&&(r.errors=null,r.hideErrors()),r.hideLoader(),r.setFields(e),t&&t.call(r,e,n)},checkAddressFail:function(e,t){var r=this;this.$element;clearTimeout(r.timerQueryRetry),"OVER_QUERY_LIMIT"===e?r.timerQueryRetry=setTimeout(function(){r.checkAddress()},r.settings.retryTime):(r.errors=e,r.hideLoader(),r.showErrors(),t&&t.call(r,e))},setFields:function(e){var t=this;t.settings.countrySelector&&o(e,"country","long_name")&&$(t.settings.countrySelector).val(o(e,"country","long_name")),t.settings.countryShortSelector&&o(e,"country","short_name")&&$(t.settings.countryShortSelector).val(o(e,"country","short_name")),t.settings.citySelector&&o(e,"administrative_area_level_1","long_name")&&$(t.settings.citySelector).val(o(e,"locality","long_name")),t.settings.stateSelector&&o(e,"administrative_area_level_1","long_name")&&$(t.settings.stateSelector).val(o(e,"administrative_area_level_1","long_name")),t.settings.stateShortSelector&&o(e,"administrative_area_level_1","short_name")&&$(t.settings.stateShortSelector).val(o(e,"administrative_area_level_1","short_name")),t.settings.postalCodeSelector&&o(e,"postal_code","long_name")&&$(t.settings.postalCodeSelector).val(o(e,"postal_code","long_name")),t.settings.routeSelector&&o(e,"route","long_name")&&$(t.settings.routeSelector).val(o(e,"route","long_name")),t.settings.streetNumberSelector&&o(e,"street_number","long_name")&&$(t.settings.streetNumberSelector).val(o(e,"street_number","long_name"))},showErrors:function(){var e=this;"ZERO_RESULTS"===e.errors||"NO_RESULTS"===e.errors?$(e.settings.messageSelector).text(e.settings.customErrorMessage).show():e.errors in i?$(e.settings.messageSelector).text(i[e.errors]).show():$(e.settings.messageSelector).text(e.errors).show()},hideErrors:function(){var e=this;$(e.settings.messageSelector).hide().empty()},showLoader:function(){var e=this;$(e.settings.loaderSelector).show()},hideLoader:function(){var e=this;$(e.settings.loaderSelector).hide()},unbindEvents:function(){var e=this;e.$element.off(e.eventPrefix)},destroy:function(){var e=this;e.unbindEvents(),e.$element.data("addressIntegration",null)}},e.defaults={zipcodeMode:!1,regionInfluence:!1,regionRestriction:!1,events:"propertychange change click keyup input paste addressIntegrationInputChange",debounceEventsTime:250,retryTime:3e3,customErrorMessage:"No results for given data, the given place propably does not exist.",countrySelector:"#country",countryShortSelector:"#country-short",citySelector:"#city",stateSelector:"#state",stateShortSelector:"#state-short",postalCodeSelector:"#postal-code",routeSelector:"#route",streetNumberSelector:"#street-number",loaderSelector:"#address-integration-loader",messageSelector:"#address-integration-messages",callbackEventFired:function(){},callbackInProgress:function(){},callbackSuccess:function(e,t){},callbackError:function(e){}},$.fn.addressIntegration=e}();